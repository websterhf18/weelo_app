64f03b4397917e022bf6bc4c00491f2a
"use strict";

var _interopRequireDefault2 = require("@babel/runtime/helpers/interopRequireDefault");

var _extends2 = _interopRequireDefault2(require("@babel/runtime/helpers/extends"));

var _defineProperty2 = _interopRequireDefault2(require("@babel/runtime/helpers/defineProperty"));

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _waitFor = _interopRequireDefault(require("../waitFor"));

var _errors = require("./errors");

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

function isNodeValid(node) {
  return typeof node.type === 'string';
}

function makeAliases(aliases, query) {
  return aliases.map(function (alias) {
    return (0, _defineProperty2.default)({}, alias, query);
  }).reduce(function (acc, query) {
    return (0, _extends2.default)({}, acc, query);
  }, {});
}

var makeA11yQuery = function makeA11yQuery(name, queryNames, matcherFn) {
  return function (instance) {
    var getBy = function getBy(matcher) {
      try {
        return instance.find(function (node) {
          return isNodeValid(node) && matcherFn(node.props[name], matcher);
        });
      } catch (error) {
        throw new _errors.ErrorWithStack((0, _errors.prepareErrorMessage)(error, name, matcher), getBy);
      }
    };

    var getAllBy = function getAllBy(matcher) {
      var results = instance.findAll(function (node) {
        return isNodeValid(node) && matcherFn(node.props[name], matcher);
      });

      if (results.length === 0) {
        throw new _errors.ErrorWithStack((0, _errors.prepareErrorMessage)(new Error('No instances found'), name, matcher), getAllBy);
      }

      return results;
    };

    var queryBy = function queryBy(matcher) {
      try {
        return getBy(matcher);
      } catch (error) {
        return (0, _errors.createQueryByError)(error, queryBy);
      }
    };

    var queryAllBy = function queryAllBy(matcher) {
      try {
        return getAllBy(matcher);
      } catch (error) {
        return [];
      }
    };

    var findBy = function findBy(matcher, waitForOptions) {
      return (0, _waitFor.default)(function () {
        return getBy(matcher);
      }, waitForOptions);
    };

    var findAllBy = function findAllBy(matcher, waitForOptions) {
      return (0, _waitFor.default)(function () {
        return getAllBy(matcher);
      }, waitForOptions);
    };

    return (0, _extends2.default)({}, makeAliases(queryNames.getBy, getBy), makeAliases(queryNames.getAllBy, getAllBy), makeAliases(queryNames.queryBy, queryBy), makeAliases(queryNames.queryAllBy, queryAllBy), makeAliases(queryNames.findBy, findBy), makeAliases(queryNames.findAllBy, findAllBy));
  };
};

var _default = makeA11yQuery;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1ha2VBMTF5UXVlcnkuanMiXSwibmFtZXMiOlsiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJkZWZhdWx0IiwiX3dhaXRGb3IiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9lcnJvcnMiLCJvYmoiLCJfX2VzTW9kdWxlIiwiaXNOb2RlVmFsaWQiLCJub2RlIiwidHlwZSIsIm1ha2VBbGlhc2VzIiwiYWxpYXNlcyIsInF1ZXJ5IiwibWFwIiwiYWxpYXMiLCJyZWR1Y2UiLCJhY2MiLCJtYWtlQTExeVF1ZXJ5IiwibmFtZSIsInF1ZXJ5TmFtZXMiLCJtYXRjaGVyRm4iLCJpbnN0YW5jZSIsImdldEJ5IiwibWF0Y2hlciIsImZpbmQiLCJwcm9wcyIsImVycm9yIiwiRXJyb3JXaXRoU3RhY2siLCJwcmVwYXJlRXJyb3JNZXNzYWdlIiwiZ2V0QWxsQnkiLCJyZXN1bHRzIiwiZmluZEFsbCIsImxlbmd0aCIsIkVycm9yIiwicXVlcnlCeSIsImNyZWF0ZVF1ZXJ5QnlFcnJvciIsInF1ZXJ5QWxsQnkiLCJmaW5kQnkiLCJ3YWl0Rm9yT3B0aW9ucyIsImZpbmRBbGxCeSIsIl9kZWZhdWx0Il0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7QUFFQUEsTUFBTSxDQUFDQyxjQUFQLENBQXNCQyxPQUF0QixFQUErQixZQUEvQixFQUE2QztBQUMzQ0MsRUFBQUEsS0FBSyxFQUFFO0FBRG9DLENBQTdDO0FBR0FELE9BQU8sQ0FBQ0UsT0FBUixHQUFrQixLQUFLLENBQXZCOztBQUVBLElBQUlDLFFBQVEsR0FBR0Msc0JBQXNCLENBQUNDLE9BQU8sY0FBUixDQUFyQzs7QUFFQSxJQUFJQyxPQUFPLEdBQUdELE9BQU8sWUFBckI7O0FBRUEsU0FBU0Qsc0JBQVQsQ0FBZ0NHLEdBQWhDLEVBQXFDO0FBQUUsU0FBT0EsR0FBRyxJQUFJQSxHQUFHLENBQUNDLFVBQVgsR0FBd0JELEdBQXhCLEdBQThCO0FBQUVMLElBQUFBLE9BQU8s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QUFBQSxPQUF0QixFQUE0Q2UsY0FBNUMsQ0FBUDtBQUNELEtBRkQ7O0FBSUEsUUFBTUMsU0FBUyxHQUFHLFNBQVpBLFNBQVksQ0FBQ2hCLE9BQUQsRUFBVWUsY0FBVixFQUE2QjtBQUM3QyxhQUFPLENBQUMsR0FBR3JDLFFBQVEsQ0FBQ0QsT0FBYixFQUFzQjtBQUFBLGVBQU02QixRQUFRLENBQUNOLE9BQUQsQ0FBZDtBQUFBLE9BQXRCLEVBQStDZSxjQUEvQyxDQUFQO0FBQ0QsS0FGRDs7QUFJQSxzQ0FBWTVCLFdBQVcsQ0FBQ1MsVUFBVSxDQUFDRyxLQUFaLEVBQW1CQSxLQUFuQixDQUF2QixFQUNLWixXQUFXLENBQUNTLFVBQVUsQ0FBQ1UsUUFBWixFQUFzQkEsUUFBdEIsQ0FEaEIsRUFFS25CLFdBQVcsQ0FBQ1MsVUFBVSxDQUFDZSxPQUFaLEVBQXFCQSxPQUFyQixDQUZoQixFQUdLeEIsV0FBVyxDQUFDUyxVQUFVLENBQUNpQixVQUFaLEVBQXdCQSxVQUF4QixDQUhoQixFQUlLMUIsV0FBVyxDQUFDUyxVQUFVLENBQUNrQixNQUFaLEVBQW9CQSxNQUFwQixDQUpoQixFQUtLM0IsV0FBVyxDQUFDUyxVQUFVLENBQUNvQixTQUFaLEVBQXVCQSxTQUF2QixDQUxoQjtBQU9ELEdBbERxQjtBQUFBLENBQXRCOztBQW9EQSxJQUFJQyxRQUFRLEdBQUd2QixhQUFmO0FBQ0FuQixPQUFPLENBQUNFLE9BQVIsR0FBa0J3QyxRQUFsQiIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5kZWZhdWx0ID0gdm9pZCAwO1xuXG52YXIgX3dhaXRGb3IgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuLi93YWl0Rm9yXCIpKTtcblxudmFyIF9lcnJvcnMgPSByZXF1aXJlKFwiLi9lcnJvcnNcIik7XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9XG5cbmZ1bmN0aW9uIGlzTm9kZVZhbGlkKG5vZGUpIHtcbiAgcmV0dXJuIHR5cGVvZiBub2RlLnR5cGUgPT09ICdzdHJpbmcnO1xufVxuXG5mdW5jdGlvbiBtYWtlQWxpYXNlcyhhbGlhc2VzLCBxdWVyeSkge1xuICByZXR1cm4gYWxpYXNlcy5tYXAoYWxpYXMgPT4gKHtcbiAgICBbYWxpYXNdOiBxdWVyeVxuICB9KSkucmVkdWNlKChhY2MsIHF1ZXJ5KSA9PiAoeyAuLi5hY2MsXG4gICAgLi4ucXVlcnlcbiAgfSksIHt9KTtcbn1cblxuY29uc3QgbWFrZUExMXlRdWVyeSA9IChuYW1lLCBxdWVyeU5hbWVzLCBtYXRjaGVyRm4pID0+IGluc3RhbmNlID0+IHtcbiAgY29uc3QgZ2V0QnkgPSBtYXRjaGVyID0+IHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGluc3RhbmNlLmZpbmQobm9kZSA9PiBpc05vZGVWYWxpZChub2RlKSAmJiBtYXRjaGVyRm4obm9kZS5wcm9wc1tuYW1lXSwgbWF0Y2hlcikpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgX2Vycm9ycy5FcnJvcldpdGhTdGFjaygoMCwgX2Vycm9ycy5wcmVwYXJlRXJyb3JNZXNzYWdlKShlcnJvciwgbmFtZSwgbWF0Y2hlciksIGdldEJ5KTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgZ2V0QWxsQnkgPSBtYXRjaGVyID0+IHtcbiAgICBjb25zdCByZXN1bHRzID0gaW5zdGFuY2UuZmluZEFsbChub2RlID0+IGlzTm9kZVZhbGlkKG5vZGUpICYmIG1hdGNoZXJGbihub2RlLnByb3BzW25hbWVdLCBtYXRjaGVyKSk7XG5cbiAgICBpZiAocmVzdWx0cy5sZW5ndGggPT09IDApIHtcbiAgICAgIHRocm93IG5ldyBfZXJyb3JzLkVycm9yV2l0aFN0YWNrKCgwLCBfZXJyb3JzLnByZXBhcmVFcnJvck1lc3NhZ2UpKG5ldyBFcnJvcignTm8gaW5zdGFuY2VzIGZvdW5kJyksIG5hbWUsIG1hdGNoZXIpLCBnZXRBbGxCeSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdHM7XG4gIH07XG5cbiAgY29uc3QgcXVlcnlCeSA9IG1hdGNoZXIgPT4ge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gZ2V0QnkobWF0Y2hlcik7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiAoMCwgX2Vycm9ycy5jcmVhdGVRdWVyeUJ5RXJyb3IpKGVycm9yLCBxdWVyeUJ5KTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgcXVlcnlBbGxCeSA9IG1hdGNoZXIgPT4ge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gZ2V0QWxsQnkobWF0Y2hlcik7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgZmluZEJ5ID0gKG1hdGNoZXIsIHdhaXRGb3JPcHRpb25zKSA9PiB7XG4gICAgcmV0dXJuICgwLCBfd2FpdEZvci5kZWZhdWx0KSgoKSA9PiBnZXRCeShtYXRjaGVyKSwgd2FpdEZvck9wdGlvbnMpO1xuICB9O1xuXG4gIGNvbnN0IGZpbmRBbGxCeSA9IChtYXRjaGVyLCB3YWl0Rm9yT3B0aW9ucykgPT4ge1xuICAgIHJldHVybiAoMCwgX3dhaXRGb3IuZGVmYXVsdCkoKCkgPT4gZ2V0QWxsQnkobWF0Y2hlciksIHdhaXRGb3JPcHRpb25zKTtcbiAgfTtcblxuICByZXR1cm4geyAuLi5tYWtlQWxpYXNlcyhxdWVyeU5hbWVzLmdldEJ5LCBnZXRCeSksXG4gICAgLi4ubWFrZUFsaWFzZXMocXVlcnlOYW1lcy5nZXRBbGxCeSwgZ2V0QWxsQnkpLFxuICAgIC4uLm1ha2VBbGlhc2VzKHF1ZXJ5TmFtZXMucXVlcnlCeSwgcXVlcnlCeSksXG4gICAgLi4ubWFrZUFsaWFzZXMocXVlcnlOYW1lcy5xdWVyeUFsbEJ5LCBxdWVyeUFsbEJ5KSxcbiAgICAuLi5tYWtlQWxpYXNlcyhxdWVyeU5hbWVzLmZpbmRCeSwgZmluZEJ5KSxcbiAgICAuLi5tYWtlQWxpYXNlcyhxdWVyeU5hbWVzLmZpbmRBbGxCeSwgZmluZEFsbEJ5KVxuICB9O1xufTtcblxudmFyIF9kZWZhdWx0ID0gbWFrZUExMXlRdWVyeTtcbmV4cG9ydHMuZGVmYXVsdCA9IF9kZWZhdWx0OyJdfQ==