51d6664e81fb5b8e08d384d0ae1f0e36
'use strict';

exports.__esModule = true;
exports.defaultMemoize = defaultMemoize;
exports.createSelectorCreator = createSelectorCreator;
exports.createStructuredSelector = createStructuredSelector;

function defaultEqualityCheck(a, b) {
  return a === b;
}

function areArgumentsShallowlyEqual(equalityCheck, prev, next) {
  if (prev === null || next === null || prev.length !== next.length) {
    return false;
  }

  var length = prev.length;

  for (var i = 0; i < length; i++) {
    if (!equalityCheck(prev[i], next[i])) {
      return false;
    }
  }

  return true;
}

function defaultMemoize(func) {
  var equalityCheck = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : defaultEqualityCheck;
  var lastArgs = null;
  var lastResult = null;
  return function () {
    if (!areArgumentsShallowlyEqual(equalityCheck, lastArgs, arguments)) {
      lastResult = func.apply(null, arguments);
    }

    lastArgs = arguments;
    return lastResult;
  };
}

function getDependencies(funcs) {
  var dependencies = Array.isArray(funcs[0]) ? funcs[0] : funcs;

  if (!dependencies.every(function (dep) {
    return typeof dep === 'function';
  })) {
    var dependencyTypes = dependencies.map(function (dep) {
      return typeof dep;
    }).join(', ');
    throw new Error('Selector creators expect all input-selectors to be functions, ' + ('instead received the following types: [' + dependencyTypes + ']'));
  }

  return dependencies;
}

function createSelectorCreator(memoize) {
  for (var _len = arguments.length, memoizeOptions = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
    memoizeOptions[_key - 1] = arguments[_key];
  }

  return function () {
    for (var _len2 = arguments.length, funcs = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
      funcs[_key2] = arguments[_key2];
    }

    var recomputations = 0;
    var resultFunc = funcs.pop();
    var dependencies = getDependencies(funcs);
    var memoizedResultFunc = memoize.apply(undefined, [function () {
      recomputations++;
      return resultFunc.apply(null, arguments);
    }].concat(memoizeOptions));
    var selector = memoize(function () {
      var params = [];
      var length = dependencies.length;

      for (var i = 0; i < length; i++) {
        params.push(dependencies[i].apply(null, arguments));
      }

      return memoizedResultFunc.apply(null, params);
    });
    selector.resultFunc = resultFunc;
    selector.dependencies = dependencies;

    selector.recomputations = function () {
      return recomputations;
    };

    selector.resetRecomputations = function () {
      return recomputations = 0;
    };

    return selector;
  };
}

var createSelector = exports.createSelector = createSelectorCreator(defaultMemoize);

function createStructuredSelector(selectors) {
  var selectorCreator = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : createSelector;

  if (typeof selectors !== 'object') {
    throw new Error('createStructuredSelector expects first argument to be an object ' + ('where each property is a selector, instead received a ' + typeof selectors));
  }

  var objectKeys = Object.keys(selectors);
  return selectorCreator(objectKeys.map(function (key) {
    return selectors[key];
  }), function () {
    for (var _len3 = arguments.length, values = Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {
      values[_key3] = arguments[_key3];
    }

    return values.reduce(function (composition, value, index) {
      composition[objectKeys[index]] = value;
      return composition;
    }, {});
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImV4cG9ydHMiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdE1lbW9pemUiLCJjcmVhdGVTZWxlY3RvckNyZWF0b3IiLCJjcmVhdGVTdHJ1Y3R1cmVkU2VsZWN0b3IiLCJkZWZhdWx0RXF1YWxpdHlDaGVjayIsImEiLCJiIiwiYXJlQXJndW1lbnRzU2hhbGxvd2x5RXF1YWwiLCJlcXVhbGl0eUNoZWNrIiwicHJldiIsIm5leHQiLCJsZW5ndGgiLCJpIiwiZnVuYyIsImFyZ3VtZW50cyIsInVuZGVmaW5lZCIsImxhc3RBcmdzIiwibGFzdFJlc3VsdCIsImFwcGx5IiwiZ2V0RGVwZW5kZW5jaWVzIiwiZnVuY3MiLCJkZXBlbmRlbmNpZXMiLCJBcnJheSIsImlzQXJyYXkiLCJldmVyeSIsImRlcCIsImRlcGVuZGVuY3lUeXBlcyIsIm1hcCIsImpvaW4iLCJFcnJvciIsIm1lbW9pemUiLCJfbGVuIiwibWVtb2l6ZU9wdGlvbnMiLCJfa2V5IiwiX2xlbjIiLCJfa2V5MiIsInJlY29tcHV0YXRpb25zIiwicmVzdWx0RnVuYyIsInBvcCIsIm1lbW9pemVkUmVzdWx0RnVuYyIsImNvbmNhdCIsInNlbGVjdG9yIiwicGFyYW1zIiwicHVzaCIsInJlc2V0UmVjb21wdXRhdGlvbnMiLCJjcmVhdGVTZWxlY3RvciIsInNlbGVjdG9ycyIsInNlbGVjdG9yQ3JlYXRvciIsIm9iamVjdEtleXMiLCJPYmplY3QiLCJrZXlzIiwia2V5IiwiX2xlbjMiLCJ2YWx1ZXMiLCJfa2V5MyIsInJlZHVjZSIsImNvbXBvc2l0aW9uIiwidmFsdWUiLCJpbmRleCJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUFBLE9BQU8sQ0FBQ0MsVUFBUixHQUFxQixJQUFyQjtBQUNBRCxPQUFPLENBQUNFLGNBQVIsR0FBeUJBLGNBQXpCO0FBQ0FGLE9BQU8sQ0FBQ0cscUJBQVIsR0FBZ0NBLHFCQUFoQztBQUNBSCxPQUFPLENBQUNJLHdCQUFSLEdBQW1DQSx3QkFBbkM7O0FBQ0Es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QUFHRixLQUE3RSxFQUFvRkUsS0FBSyxFQUF6RixFQUE2RjtBQUMzRkQsTUFBQUEsTUFBTSxDQUFDQyxLQUFELENBQU4sR0FBZ0J4QyxTQUFTLENBQUN3QyxLQUFELENBQXpCO0FBQ0Q7O0FBRUQsV0FBT0QsTUFBTSxDQUFDRSxNQUFQLENBQWMsVUFBVUMsV0FBVixFQUF1QkMsS0FBdkIsRUFBOEJDLEtBQTlCLEVBQXFDO0FBQ3hERixNQUFBQSxXQUFXLENBQUNSLFVBQVUsQ0FBQ1UsS0FBRCxDQUFYLENBQVgsR0FBaUNELEtBQWpDO0FBQ0EsYUFBT0QsV0FBUDtBQUNELEtBSE0sRUFHSixFQUhJLENBQVA7QUFJRCxHQVhxQixDQUF0QjtBQVlEIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuZXhwb3J0cy5kZWZhdWx0TWVtb2l6ZSA9IGRlZmF1bHRNZW1vaXplO1xuZXhwb3J0cy5jcmVhdGVTZWxlY3RvckNyZWF0b3IgPSBjcmVhdGVTZWxlY3RvckNyZWF0b3I7XG5leHBvcnRzLmNyZWF0ZVN0cnVjdHVyZWRTZWxlY3RvciA9IGNyZWF0ZVN0cnVjdHVyZWRTZWxlY3RvcjtcbmZ1bmN0aW9uIGRlZmF1bHRFcXVhbGl0eUNoZWNrKGEsIGIpIHtcbiAgcmV0dXJuIGEgPT09IGI7XG59XG5cbmZ1bmN0aW9uIGFyZUFyZ3VtZW50c1NoYWxsb3dseUVxdWFsKGVxdWFsaXR5Q2hlY2ssIHByZXYsIG5leHQpIHtcbiAgaWYgKHByZXYgPT09IG51bGwgfHwgbmV4dCA9PT0gbnVsbCB8fCBwcmV2Lmxlbmd0aCAhPT0gbmV4dC5sZW5ndGgpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvLyBEbyB0aGlzIGluIGEgZm9yIGxvb3AgKGFuZCBub3QgYSBgZm9yRWFjaGAgb3IgYW4gYGV2ZXJ5YCkgc28gd2UgY2FuIGRldGVybWluZSBlcXVhbGl0eSBhcyBmYXN0IGFzIHBvc3NpYmxlLlxuICB2YXIgbGVuZ3RoID0gcHJldi5sZW5ndGg7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICBpZiAoIWVxdWFsaXR5Q2hlY2socHJldltpXSwgbmV4dFtpXSkpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gdHJ1ZTtcbn1cblxuZnVuY3Rpb24gZGVmYXVsdE1lbW9pemUoZnVuYykge1xuICB2YXIgZXF1YWxpdHlDaGVjayA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZGVmYXVsdEVxdWFsaXR5Q2hlY2s7XG5cbiAgdmFyIGxhc3RBcmdzID0gbnVsbDtcbiAgdmFyIGxhc3RSZXN1bHQgPSBudWxsO1xuICAvLyB3ZSByZWZlcmVuY2UgYXJndW1lbnRzIGluc3RlYWQgb2Ygc3ByZWFkaW5nIHRoZW0gZm9yIHBlcmZvcm1hbmNlIHJlYXNvbnNcbiAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoIWFyZUFyZ3VtZW50c1NoYWxsb3dseUVxdWFsKGVxdWFsaXR5Q2hlY2ssIGxhc3RBcmdzLCBhcmd1bWVudHMpKSB7XG4gICAgICAvLyBhcHBseSBhcmd1bWVudHMgaW5zdGVhZCBvZiBzcHJlYWRpbmcgZm9yIHBlcmZvcm1hbmNlLlxuICAgICAgbGFzdFJlc3VsdCA9IGZ1bmMuYXBwbHkobnVsbCwgYXJndW1lbnRzKTtcbiAgICB9XG5cbiAgICBsYXN0QXJncyA9IGFyZ3VtZW50cztcbiAgICByZXR1cm4gbGFzdFJlc3VsdDtcbiAgfTtcbn1cblxuZnVuY3Rpb24gZ2V0RGVwZW5kZW5jaWVzKGZ1bmNzKSB7XG4gIHZhciBkZXBlbmRlbmNpZXMgPSBBcnJheS5pc0FycmF5KGZ1bmNzWzBdKSA/IGZ1bmNzWzBdIDogZnVuY3M7XG5cbiAgaWYgKCFkZXBlbmRlbmNpZXMuZXZlcnkoZnVuY3Rpb24gKGRlcCkge1xuICAgIHJldHVybiB0eXBlb2YgZGVwID09PSAnZnVuY3Rpb24nO1xuICB9KSkge1xuICAgIHZhciBkZXBlbmRlbmN5VHlwZXMgPSBkZXBlbmRlbmNpZXMubWFwKGZ1bmN0aW9uIChkZXApIHtcbiAgICAgIHJldHVybiB0eXBlb2YgZGVwO1xuICAgIH0pLmpvaW4oJywgJyk7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdTZWxlY3RvciBjcmVhdG9ycyBleHBlY3QgYWxsIGlucHV0LXNlbGVjdG9ycyB0byBiZSBmdW5jdGlvbnMsICcgKyAoJ2luc3RlYWQgcmVjZWl2ZWQgdGhlIGZvbGxvd2luZyB0eXBlczogWycgKyBkZXBlbmRlbmN5VHlwZXMgKyAnXScpKTtcbiAgfVxuXG4gIHJldHVybiBkZXBlbmRlbmNpZXM7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVNlbGVjdG9yQ3JlYXRvcihtZW1vaXplKSB7XG4gIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBtZW1vaXplT3B0aW9ucyA9IEFycmF5KF9sZW4gPiAxID8gX2xlbiAtIDEgOiAwKSwgX2tleSA9IDE7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHtcbiAgICBtZW1vaXplT3B0aW9uc1tfa2V5IC0gMV0gPSBhcmd1bWVudHNbX2tleV07XG4gIH1cblxuICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIF9sZW4yID0gYXJndW1lbnRzLmxlbmd0aCwgZnVuY3MgPSBBcnJheShfbGVuMiksIF9rZXkyID0gMDsgX2tleTIgPCBfbGVuMjsgX2tleTIrKykge1xuICAgICAgZnVuY3NbX2tleTJdID0gYXJndW1lbnRzW19rZXkyXTtcbiAgICB9XG5cbiAgICB2YXIgcmVjb21wdXRhdGlvbnMgPSAwO1xuICAgIHZhciByZXN1bHRGdW5jID0gZnVuY3MucG9wKCk7XG4gICAgdmFyIGRlcGVuZGVuY2llcyA9IGdldERlcGVuZGVuY2llcyhmdW5jcyk7XG5cbiAgICB2YXIgbWVtb2l6ZWRSZXN1bHRGdW5jID0gbWVtb2l6ZS5hcHBseSh1bmRlZmluZWQsIFtmdW5jdGlvbiAoKSB7XG4gICAgICByZWNvbXB1dGF0aW9ucysrO1xuICAgICAgLy8gYXBwbHkgYXJndW1lbnRzIGluc3RlYWQgb2Ygc3ByZWFkaW5nIGZvciBwZXJmb3JtYW5jZS5cbiAgICAgIHJldHVybiByZXN1bHRGdW5jLmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7XG4gICAgfV0uY29uY2F0KG1lbW9pemVPcHRpb25zKSk7XG5cbiAgICAvLyBJZiBhIHNlbGVjdG9yIGlzIGNhbGxlZCB3aXRoIHRoZSBleGFjdCBzYW1lIGFyZ3VtZW50cyB3ZSBkb24ndCBuZWVkIHRvIHRyYXZlcnNlIG91ciBkZXBlbmRlbmNpZXMgYWdhaW4uXG4gICAgdmFyIHNlbGVjdG9yID0gbWVtb2l6ZShmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgcGFyYW1zID0gW107XG4gICAgICB2YXIgbGVuZ3RoID0gZGVwZW5kZW5jaWVzLmxlbmd0aDtcblxuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICAvLyBhcHBseSBhcmd1bWVudHMgaW5zdGVhZCBvZiBzcHJlYWRpbmcgYW5kIG11dGF0ZSBhIGxvY2FsIGxpc3Qgb2YgcGFyYW1zIGZvciBwZXJmb3JtYW5jZS5cbiAgICAgICAgcGFyYW1zLnB1c2goZGVwZW5kZW5jaWVzW2ldLmFwcGx5KG51bGwsIGFyZ3VtZW50cykpO1xuICAgICAgfVxuXG4gICAgICAvLyBhcHBseSBhcmd1bWVudHMgaW5zdGVhZCBvZiBzcHJlYWRpbmcgZm9yIHBlcmZvcm1hbmNlLlxuICAgICAgcmV0dXJuIG1lbW9pemVkUmVzdWx0RnVuYy5hcHBseShudWxsLCBwYXJhbXMpO1xuICAgIH0pO1xuXG4gICAgc2VsZWN0b3IucmVzdWx0RnVuYyA9IHJlc3VsdEZ1bmM7XG4gICAgc2VsZWN0b3IuZGVwZW5kZW5jaWVzID0gZGVwZW5kZW5jaWVzO1xuICAgIHNlbGVjdG9yLnJlY29tcHV0YXRpb25zID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHJlY29tcHV0YXRpb25zO1xuICAgIH07XG4gICAgc2VsZWN0b3IucmVzZXRSZWNvbXB1dGF0aW9ucyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiByZWNvbXB1dGF0aW9ucyA9IDA7XG4gICAgfTtcbiAgICByZXR1cm4gc2VsZWN0b3I7XG4gIH07XG59XG5cbnZhciBjcmVhdGVTZWxlY3RvciA9IGV4cG9ydHMuY3JlYXRlU2VsZWN0b3IgPSBjcmVhdGVTZWxlY3RvckNyZWF0b3IoZGVmYXVsdE1lbW9pemUpO1xuXG5mdW5jdGlvbiBjcmVhdGVTdHJ1Y3R1cmVkU2VsZWN0b3Ioc2VsZWN0b3JzKSB7XG4gIHZhciBzZWxlY3RvckNyZWF0b3IgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGNyZWF0ZVNlbGVjdG9yO1xuXG4gIGlmICh0eXBlb2Ygc2VsZWN0b3JzICE9PSAnb2JqZWN0Jykge1xuICAgIHRocm93IG5ldyBFcnJvcignY3JlYXRlU3RydWN0dXJlZFNlbGVjdG9yIGV4cGVjdHMgZmlyc3QgYXJndW1lbnQgdG8gYmUgYW4gb2JqZWN0ICcgKyAoJ3doZXJlIGVhY2ggcHJvcGVydHkgaXMgYSBzZWxlY3RvciwgaW5zdGVhZCByZWNlaXZlZCBhICcgKyB0eXBlb2Ygc2VsZWN0b3JzKSk7XG4gIH1cbiAgdmFyIG9iamVjdEtleXMgPSBPYmplY3Qua2V5cyhzZWxlY3RvcnMpO1xuICByZXR1cm4gc2VsZWN0b3JDcmVhdG9yKG9iamVjdEtleXMubWFwKGZ1bmN0aW9uIChrZXkpIHtcbiAgICByZXR1cm4gc2VsZWN0b3JzW2tleV07XG4gIH0pLCBmdW5jdGlvbiAoKSB7XG4gICAgZm9yICh2YXIgX2xlbjMgPSBhcmd1bWVudHMubGVuZ3RoLCB2YWx1ZXMgPSBBcnJheShfbGVuMyksIF9rZXkzID0gMDsgX2tleTMgPCBfbGVuMzsgX2tleTMrKykge1xuICAgICAgdmFsdWVzW19rZXkzXSA9IGFyZ3VtZW50c1tfa2V5M107XG4gICAgfVxuXG4gICAgcmV0dXJuIHZhbHVlcy5yZWR1Y2UoZnVuY3Rpb24gKGNvbXBvc2l0aW9uLCB2YWx1ZSwgaW5kZXgpIHtcbiAgICAgIGNvbXBvc2l0aW9uW29iamVjdEtleXNbaW5kZXhdXSA9IHZhbHVlO1xuICAgICAgcmV0dXJuIGNvbXBvc2l0aW9uO1xuICAgIH0sIHt9KTtcbiAgfSk7XG59Il19