143ee2fbce88d06a8602498606c826d9
'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
});
exports.default = exports.test = exports.serialize = void 0;

var ReactIs = _interopRequireWildcard(require('react-is'));

var _markup = require("./lib/markup");

function _getRequireWildcardCache() {
  if (typeof WeakMap !== 'function') return null;
  var cache = new WeakMap();

  _getRequireWildcardCache = function _getRequireWildcardCache() {
    return cache;
  };

  return cache;
}

function _interopRequireWildcard(obj) {
  if (obj && obj.__esModule) {
    return obj;
  }

  if (obj === null || typeof obj !== 'object' && typeof obj !== 'function') {
    return {
      default: obj
    };
  }

  var cache = _getRequireWildcardCache();

  if (cache && cache.has(obj)) {
    return cache.get(obj);
  }

  var newObj = {};
  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;

  for (var key in obj) {
    if (Object.prototype.hasOwnProperty.call(obj, key)) {
      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;

      if (desc && (desc.get || desc.set)) {
        Object.defineProperty(newObj, key, desc);
      } else {
        newObj[key] = obj[key];
      }
    }
  }

  newObj.default = obj;

  if (cache) {
    cache.set(obj, newObj);
  }

  return newObj;
}

var getChildren = function getChildren(arg) {
  var children = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];

  if (Array.isArray(arg)) {
    arg.forEach(function (item) {
      getChildren(item, children);
    });
  } else if (arg != null && arg !== false) {
    children.push(arg);
  }

  return children;
};

var getType = function getType(element) {
  var type = element.type;

  if (typeof type === 'string') {
    return type;
  }

  if (typeof type === 'function') {
    return type.displayName || type.name || 'Unknown';
  }

  if (ReactIs.isFragment(element)) {
    return 'React.Fragment';
  }

  if (ReactIs.isSuspense(element)) {
    return 'React.Suspense';
  }

  if (typeof type === 'object' && type !== null) {
    if (ReactIs.isContextProvider(element)) {
      return 'Context.Provider';
    }

    if (ReactIs.isContextConsumer(element)) {
      return 'Context.Consumer';
    }

    if (ReactIs.isForwardRef(element)) {
      if (type.displayName) {
        return type.displayName;
      }

      var functionName = type.render.displayName || type.render.name || '';
      return functionName !== '' ? 'ForwardRef(' + functionName + ')' : 'ForwardRef';
    }

    if (ReactIs.isMemo(element)) {
      var _functionName = type.displayName || type.type.displayName || type.type.name || '';

      return _functionName !== '' ? 'Memo(' + _functionName + ')' : 'Memo';
    }
  }

  return 'UNDEFINED';
};

var getPropKeys = function getPropKeys(element) {
  var props = element.props;
  return Object.keys(props).filter(function (key) {
    return key !== 'children' && props[key] !== undefined;
  }).sort();
};

var serialize = function serialize(element, config, indentation, depth, refs, printer) {
  return ++depth > config.maxDepth ? (0, _markup.printElementAsLeaf)(getType(element), config) : (0, _markup.printElement)(getType(element), (0, _markup.printProps)(getPropKeys(element), element.props, config, indentation + config.indent, depth, refs, printer), (0, _markup.printChildren)(getChildren(element.props.children), config, indentation + config.indent, depth, refs, printer), config, indentation);
};

exports.serialize = serialize;

var test = function test(val) {
  return val && ReactIs.isElement(val);
};

exports.test = test;
var plugin = {
  serialize: serialize,
  test: test
};
var _default = plugin;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlJlYWN0RWxlbWVudC5qcyJdLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsImRlZmF1bHQiLCJ0ZXN0Iiwic2VyaWFsaXplIiwiUmVhY3RJcyIsIl9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkIiwicmVxdWlyZSIsIl9tYXJrdXAiLCJfZ2V0UmVxdWlyZVdpbGRjYXJkQ2FjaGUiLCJXZWFrTWFwIiwiY2FjaGUiLCJvYmoiLCJfX2VzTW9kdWxlIiwiaGFzIiwiZ2V0IiwibmV3T2JqIiwiaGFzUHJvcGVydHlEZXNjcmlwdG9yIiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwia2V5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiZGVzYyIsInNldCIsImdldENoaWxkcmVuIiwiYXJnIiwiY2hpbGRyZW4iLCJBcnJheSIsImlzQXJyYXkiLCJmb3JFYWNoIiwiaXRlbSIsInB1c2giLCJnZXRUeXBlIiwiZWxlbWVudCIsInR5cGUiLCJkaXNwbGF5TmFtZSIsIm5hbWUiLCJpc0ZyYWdtZW50IiwiaXNTdXNwZW5zZSIsImlzQ29udGV4dFByb3ZpZGVyIiwiaXNDb250ZXh0Q29uc3VtZXIiLCJpc0ZvcndhcmRSZWYiLCJmdW5jdGlvbk5hbWUiLCJyZW5kZXIiLCJpc01lbW8iLCJnZXRQcm9wS2V5cyIsInByb3BzIiwia2V5cyIsImZpbHRlciIsInVuZGVmaW5lZCIsInNvcnQiLCJjb25maWciLCJpbmRlbnRhdGlvbiIsImRlcHRoIiwicmVmcyIsInByaW50ZXIiLCJtYXhEZXB0aCIsInByaW50RWxlbWVudEFzTGVhZiIsInByaW50RWxlbWVudCIsInByaW50UHJvcHMiLCJpbmRlbnQiLCJwcmludENoaWxkcmVuIiwidmFsIiwiaXNFbGVtZW50IiwicGx1Z2luIiwiX2RlZmF1bHQiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBQSxNQUFNLENBQUNDLGNBQVAsQ0FBc0JDLE9BQXRCLEVBQStCLFlBQS9C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Q0FBQ21ELFlBQVosRUFDRTFCLE9BQU8sQ0FBQ0MsT0FBRCxDQURULEVBRUUsQ0FBQyxHQUFHMUIsT0FBTyxDQUFDb0QsVUFBWixFQUNFZCxXQUFXLENBQUNaLE9BQUQsQ0FEYixFQUVFQSxPQUFPLENBQUNhLEtBRlYsRUFHRUssTUFIRixFQUlFQyxXQUFXLEdBQUdELE1BQU0sQ0FBQ1MsTUFKdkIsRUFLRVAsS0FMRixFQU1FQyxJQU5GLEVBT0VDLE9BUEYsQ0FGRixFQVdFLENBQUMsR0FBR2hELE9BQU8sQ0FBQ3NELGFBQVosRUFDRXJDLFdBQVcsQ0FBQ1MsT0FBTyxDQUFDYSxLQUFSLENBQWNwQixRQUFmLENBRGIsRUFFRXlCLE1BRkYsRUFHRUMsV0FBVyxHQUFHRCxNQUFNLENBQUNTLE1BSHZCLEVBSUVQLEtBSkYsRUFLRUMsSUFMRixFQU1FQyxPQU5GLENBWEYsRUFtQkVKLE1BbkJGLEVBb0JFQyxXQXBCRixDQUhZO0FBQUEsQ0FBbEI7O0FBMEJBckQsT0FBTyxDQUFDSSxTQUFSLEdBQW9CQSxTQUFwQjs7QUFFQSxJQUFNRCxJQUFJLEdBQUcsU0FBUEEsSUFBTyxDQUFBNEQsR0FBRztBQUFBLFNBQUlBLEdBQUcsSUFBSTFELE9BQU8sQ0FBQzJELFNBQVIsQ0FBa0JELEdBQWxCLENBQVg7QUFBQSxDQUFoQjs7QUFFQS9ELE9BQU8sQ0FBQ0csSUFBUixHQUFlQSxJQUFmO0FBQ0EsSUFBTThELE1BQU0sR0FBRztBQUNiN0QsRUFBQUEsU0FBUyxFQUFUQSxTQURhO0FBRWJELEVBQUFBLElBQUksRUFBSkE7QUFGYSxDQUFmO0FBSUEsSUFBSStELFFBQVEsR0FBR0QsTUFBZjtBQUNBakUsT0FBTyxDQUFDRSxPQUFSLEdBQWtCZ0UsUUFBbEIiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5kZWZhdWx0ID0gZXhwb3J0cy50ZXN0ID0gZXhwb3J0cy5zZXJpYWxpemUgPSB2b2lkIDA7XG5cbnZhciBSZWFjdElzID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZSgncmVhY3QtaXMnKSk7XG5cbnZhciBfbWFya3VwID0gcmVxdWlyZSgnLi9saWIvbWFya3VwJyk7XG5cbmZ1bmN0aW9uIF9nZXRSZXF1aXJlV2lsZGNhcmRDYWNoZSgpIHtcbiAgaWYgKHR5cGVvZiBXZWFrTWFwICE9PSAnZnVuY3Rpb24nKSByZXR1cm4gbnVsbDtcbiAgdmFyIGNhY2hlID0gbmV3IFdlYWtNYXAoKTtcbiAgX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBjYWNoZTtcbiAgfTtcbiAgcmV0dXJuIGNhY2hlO1xufVxuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChvYmopIHtcbiAgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkge1xuICAgIHJldHVybiBvYmo7XG4gIH1cbiAgaWYgKG9iaiA9PT0gbnVsbCB8fCAodHlwZW9mIG9iaiAhPT0gJ29iamVjdCcgJiYgdHlwZW9mIG9iaiAhPT0gJ2Z1bmN0aW9uJykpIHtcbiAgICByZXR1cm4ge2RlZmF1bHQ6IG9ian07XG4gIH1cbiAgdmFyIGNhY2hlID0gX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlKCk7XG4gIGlmIChjYWNoZSAmJiBjYWNoZS5oYXMob2JqKSkge1xuICAgIHJldHVybiBjYWNoZS5nZXQob2JqKTtcbiAgfVxuICB2YXIgbmV3T2JqID0ge307XG4gIHZhciBoYXNQcm9wZXJ0eURlc2NyaXB0b3IgPVxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSAmJiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yO1xuICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7XG4gICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHtcbiAgICAgIHZhciBkZXNjID0gaGFzUHJvcGVydHlEZXNjcmlwdG9yXG4gICAgICAgID8gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIGtleSlcbiAgICAgICAgOiBudWxsO1xuICAgICAgaWYgKGRlc2MgJiYgKGRlc2MuZ2V0IHx8IGRlc2Muc2V0KSkge1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3T2JqLCBrZXksIGRlc2MpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbmV3T2JqW2tleV0gPSBvYmpba2V5XTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgbmV3T2JqLmRlZmF1bHQgPSBvYmo7XG4gIGlmIChjYWNoZSkge1xuICAgIGNhY2hlLnNldChvYmosIG5ld09iaik7XG4gIH1cbiAgcmV0dXJuIG5ld09iajtcbn1cblxuLyoqXG4gKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqL1xuLy8gR2l2ZW4gZWxlbWVudC5wcm9wcy5jaGlsZHJlbiwgb3Igc3VidHJlZSBkdXJpbmcgcmVjdXJzaXZlIHRyYXZlcnNhbCxcbi8vIHJldHVybiBmbGF0dGVuZWQgYXJyYXkgb2YgY2hpbGRyZW4uXG5jb25zdCBnZXRDaGlsZHJlbiA9IChhcmcsIGNoaWxkcmVuID0gW10pID0+IHtcbiAgaWYgKEFycmF5LmlzQXJyYXkoYXJnKSkge1xuICAgIGFyZy5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgZ2V0Q2hpbGRyZW4oaXRlbSwgY2hpbGRyZW4pO1xuICAgIH0pO1xuICB9IGVsc2UgaWYgKGFyZyAhPSBudWxsICYmIGFyZyAhPT0gZmFsc2UpIHtcbiAgICBjaGlsZHJlbi5wdXNoKGFyZyk7XG4gIH1cblxuICByZXR1cm4gY2hpbGRyZW47XG59O1xuXG5jb25zdCBnZXRUeXBlID0gZWxlbWVudCA9PiB7XG4gIGNvbnN0IHR5cGUgPSBlbGVtZW50LnR5cGU7XG5cbiAgaWYgKHR5cGVvZiB0eXBlID09PSAnc3RyaW5nJykge1xuICAgIHJldHVybiB0eXBlO1xuICB9XG5cbiAgaWYgKHR5cGVvZiB0eXBlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgcmV0dXJuIHR5cGUuZGlzcGxheU5hbWUgfHwgdHlwZS5uYW1lIHx8ICdVbmtub3duJztcbiAgfVxuXG4gIGlmIChSZWFjdElzLmlzRnJhZ21lbnQoZWxlbWVudCkpIHtcbiAgICByZXR1cm4gJ1JlYWN0LkZyYWdtZW50JztcbiAgfVxuXG4gIGlmIChSZWFjdElzLmlzU3VzcGVuc2UoZWxlbWVudCkpIHtcbiAgICByZXR1cm4gJ1JlYWN0LlN1c3BlbnNlJztcbiAgfVxuXG4gIGlmICh0eXBlb2YgdHlwZSA9PT0gJ29iamVjdCcgJiYgdHlwZSAhPT0gbnVsbCkge1xuICAgIGlmIChSZWFjdElzLmlzQ29udGV4dFByb3ZpZGVyKGVsZW1lbnQpKSB7XG4gICAgICByZXR1cm4gJ0NvbnRleHQuUHJvdmlkZXInO1xuICAgIH1cblxuICAgIGlmIChSZWFjdElzLmlzQ29udGV4dENvbnN1bWVyKGVsZW1lbnQpKSB7XG4gICAgICByZXR1cm4gJ0NvbnRleHQuQ29uc3VtZXInO1xuICAgIH1cblxuICAgIGlmIChSZWFjdElzLmlzRm9yd2FyZFJlZihlbGVtZW50KSkge1xuICAgICAgaWYgKHR5cGUuZGlzcGxheU5hbWUpIHtcbiAgICAgICAgcmV0dXJuIHR5cGUuZGlzcGxheU5hbWU7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGZ1bmN0aW9uTmFtZSA9IHR5cGUucmVuZGVyLmRpc3BsYXlOYW1lIHx8IHR5cGUucmVuZGVyLm5hbWUgfHwgJyc7XG4gICAgICByZXR1cm4gZnVuY3Rpb25OYW1lICE9PSAnJ1xuICAgICAgICA/ICdGb3J3YXJkUmVmKCcgKyBmdW5jdGlvbk5hbWUgKyAnKSdcbiAgICAgICAgOiAnRm9yd2FyZFJlZic7XG4gICAgfVxuXG4gICAgaWYgKFJlYWN0SXMuaXNNZW1vKGVsZW1lbnQpKSB7XG4gICAgICBjb25zdCBmdW5jdGlvbk5hbWUgPVxuICAgICAgICB0eXBlLmRpc3BsYXlOYW1lIHx8IHR5cGUudHlwZS5kaXNwbGF5TmFtZSB8fCB0eXBlLnR5cGUubmFtZSB8fCAnJztcbiAgICAgIHJldHVybiBmdW5jdGlvbk5hbWUgIT09ICcnID8gJ01lbW8oJyArIGZ1bmN0aW9uTmFtZSArICcpJyA6ICdNZW1vJztcbiAgICB9XG4gIH1cblxuICByZXR1cm4gJ1VOREVGSU5FRCc7XG59O1xuXG5jb25zdCBnZXRQcm9wS2V5cyA9IGVsZW1lbnQgPT4ge1xuICBjb25zdCB7cHJvcHN9ID0gZWxlbWVudDtcbiAgcmV0dXJuIE9iamVjdC5rZXlzKHByb3BzKVxuICAgIC5maWx0ZXIoa2V5ID0+IGtleSAhPT0gJ2NoaWxkcmVuJyAmJiBwcm9wc1trZXldICE9PSB1bmRlZmluZWQpXG4gICAgLnNvcnQoKTtcbn07XG5cbmNvbnN0IHNlcmlhbGl6ZSA9IChlbGVtZW50LCBjb25maWcsIGluZGVudGF0aW9uLCBkZXB0aCwgcmVmcywgcHJpbnRlcikgPT5cbiAgKytkZXB0aCA+IGNvbmZpZy5tYXhEZXB0aFxuICAgID8gKDAsIF9tYXJrdXAucHJpbnRFbGVtZW50QXNMZWFmKShnZXRUeXBlKGVsZW1lbnQpLCBjb25maWcpXG4gICAgOiAoMCwgX21hcmt1cC5wcmludEVsZW1lbnQpKFxuICAgICAgICBnZXRUeXBlKGVsZW1lbnQpLFxuICAgICAgICAoMCwgX21hcmt1cC5wcmludFByb3BzKShcbiAgICAgICAgICBnZXRQcm9wS2V5cyhlbGVtZW50KSxcbiAgICAgICAgICBlbGVtZW50LnByb3BzLFxuICAgICAgICAgIGNvbmZpZyxcbiAgICAgICAgICBpbmRlbnRhdGlvbiArIGNvbmZpZy5pbmRlbnQsXG4gICAgICAgICAgZGVwdGgsXG4gICAgICAgICAgcmVmcyxcbiAgICAgICAgICBwcmludGVyXG4gICAgICAgICksXG4gICAgICAgICgwLCBfbWFya3VwLnByaW50Q2hpbGRyZW4pKFxuICAgICAgICAgIGdldENoaWxkcmVuKGVsZW1lbnQucHJvcHMuY2hpbGRyZW4pLFxuICAgICAgICAgIGNvbmZpZyxcbiAgICAgICAgICBpbmRlbnRhdGlvbiArIGNvbmZpZy5pbmRlbnQsXG4gICAgICAgICAgZGVwdGgsXG4gICAgICAgICAgcmVmcyxcbiAgICAgICAgICBwcmludGVyXG4gICAgICAgICksXG4gICAgICAgIGNvbmZpZyxcbiAgICAgICAgaW5kZW50YXRpb25cbiAgICAgICk7XG5cbmV4cG9ydHMuc2VyaWFsaXplID0gc2VyaWFsaXplO1xuXG5jb25zdCB0ZXN0ID0gdmFsID0+IHZhbCAmJiBSZWFjdElzLmlzRWxlbWVudCh2YWwpO1xuXG5leHBvcnRzLnRlc3QgPSB0ZXN0O1xuY29uc3QgcGx1Z2luID0ge1xuICBzZXJpYWxpemUsXG4gIHRlc3Rcbn07XG52YXIgX2RlZmF1bHQgPSBwbHVnaW47XG5leHBvcnRzLmRlZmF1bHQgPSBfZGVmYXVsdDtcbiJdfQ==